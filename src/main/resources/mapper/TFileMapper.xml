<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jz.admin.mapper.FileMapper">
    <insert id="insertWhereNotExist" useGeneratedKeys="true" keyProperty="et.id">
        insert into t_file
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="et.id != null">
                `id`,
            </if>
            <if test="et.fileName != null">
                `file_name`,
            </if>
            <if test="et.size != null">
                `size`,
            </if>
            <if test="et.type != null">
                `type`,
            </if>
            <if test="et.status != null">
                `status`,
            </if>
            <if test="et.properties != null">
                `properties`,
            </if>
            <if test="et.folderId != null">
                `folder_id`,
            </if>
            <if test="et.relativePath != null">
                `relative_path`,
            </if>
            <if test="et.createTime != null">
                `create_time`,
            </if>
            <if test="et.updateTime != null">
                `update_time`,
            </if>
            <if test="et.storageId != null">
                `storage_id`,
            </if>
        </trim>
        select
        <trim suffixOverrides=",">
            <if test="et.id != null">
                #{et.id},
            </if>
            <if test="et.fileName != null">
                #{et.fileName},
            </if>
            <if test="et.size != null">
                #{et.size},
            </if>
            <if test="et.type != null">
                #{et.type},
            </if>
            <if test="et.status != null">
                #{et.status},
            </if>
            <if test="et.properties != null">
                #{et.properties},
            </if>
            <if test="et.folderId != null">
                #{et.folderId},
            </if>
            <if test="et.relativePath != null">
                #{et.relativePath},
            </if>
            <if test="et.createTime != null">
                #{et.createTime},
            </if>
            <if test="et.updateTime != null">
                #{et.updateTime},
            </if>
            <if test="et.storageId != null">
                #{et.storageId},
            </if>
        </trim>
        from DUAL
        ${ew.customSqlSegment}
    </insert>

    <select id="getFileListWithRealPath" resultType="org.jz.admin.entity.TFile">
        select a.relative_path, a.type, b.path
        from t_file a
                 left join t_file_store b on a.storage_id = b.id
            ${ew.customSqlSegment}
            and a.status = ${@org.cn.jiangzhe.admin.entity.FileStatusEnum@CREATED.code}
    </select>
</mapper>